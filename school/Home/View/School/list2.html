<extend name="Common:base" />
<block name="rig">
<style>
	.shezhi_nav{
		margin:0px;
		border-bottom:1px solid #428bca;
	}
	.zdy-widget-body-table{
		border-top:none !important;
	}
	.zdy-widget-box{
		border:1px solid #ccc;
		border-radius:4px;
	}
*{padding:0px;margin:0px;}
#tree li{list-style:none;}
#tree ul{
    padding-left:30px;
}
.act_jia::before{
    content:' ';
    background:url('Public/Admin/img/expand.png');
    position:absolute;
    left:-18px;
    width:16px;
    height:16px;
    top:3px;
}
.act_jian::before{
    content:' ';
    background:url('Public/Admin/img/collapse.png');
    position:absolute;
    left:-18px;
    width:16px;
    height:16px;
    top:3px;
}
#select{
    display:none;
    position:absolute;
    background:#F1F1F1;
    width:90px;
    text-align:center;
}
#select p{
    padding:4px 0px;
    color:#428bca;
    font-size:12px;
    margin:0px;
}
#select p:hover{
    background:#ceffce;
}

#tree{
    margin-top:10px;
}
#tree ul .act{
    background-color:#CEFFCE;
    border: 1px solid #8AE88A;
    border-radius: 2px;
}
#tree span{
    padding:1px 10px;
    position:relative;
    padding-left:20px;
    background-repeat:no-repeat;
    background-image:url('Public/Admin/img/star.png') ;
    background-repeat: no-repeat;
    background-position:3px 3px;
}
.top_parent  span:hover{
    background-color:#DCEDFF;
}


</style>
		<div class="col-xs-12 col-sm-9 col-lg-10">
					<div class="breadcrumbs" id="breadcrumbs">
						<script type="text/javascript">
							try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
						</script>

						<ul class="breadcrumb">
							<li>
								<i class="icon-home home-icon"></i>
								学校列表
							</li>
						</ul><!-- .breadcrumb -->	
					</div>


					<ul class="nav nav-pills shezhi_nav">
						<li class="active">
							<a href="{:U('school/school_list')}">学校列表</a>
						</li>
						<li>
							<a href="{:U('school/school_add')}">添加学校</a>
						</li>
					</ul>
				
					<!-- 表格 -->
					<div class="row">
					<div class="col-xs-12" style="margin-top:10px;">

						<div class="widget-box zdy-widget-box">
							<div class="widget-body">
								<div class="widget-main padding-8">
									<table id="sample-table-2" class="table table-hover zdy-widget-body-table">
										<thead class="navbar-inner">
											<tr>
												<th>id</th>
												<th>学校名称</th>
												<th>学校id</th>
												<th>接口地址</th>
												<th>操作</th>
											</tr>
										</thead>
										<tbody>
											<volist name='list' id="school">
											<tr>
 												<td>{$school.id}</td>
												<td>{$school.name}</td>
												<td>{$school.school_id}</td>
												<td>{:urldecode($school['sdk_adder'])}</td>
												<td> 
													<a href="{:U('school/school_edit',array('id'=>$school['id']))}">编辑</a> 
													<a href="{:U('school/school_del',array('id'=>$school['id']))}" onclick=" return confirm('确定删除吗？')">删除</a> 
												</td>
											</tr>
											</volist>
										</tbody>
									</table>
									<!-- 分页 -->
								
									</div>	
							</div>
						</div>


										
					</div>
					</div>




				</div>
                <div id="tree" class="top_parent">
                <ul class="parent_1">
                    <li><span class="open_0 act_jian act">学校列表</span>
                        <ul class="parent_2">
                            <li><span class="open_1 act_jian" data-id="school-1">大学一</span>
                                <ul class="parent_3">
                                    <li><span class="open_2 act_jian" data-id="major-1">专业一</span>
                                        <ul class="parent_4">
                                            <li><span class="open_3 act_jian" data-id="class-1">1班</span>
                                                <ul class="parent_5">
                                                    <li><span class="select" data-id="studName-1">同学1</span></li>
                                                    <li><span class="select" data-id="studName-2">同学1</span></li>
                                                </ul>   
                                            </li>
                                            <li><span class="open_3 act_jian" data-id="class-2">2班</span>
                                                <ul class="parent_5">
                                                    <li><span class="select" data-id="studName-3">同学1</span></li>
                                                    <li><span class="select" data-id="studName-4">同学1</span></li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </li>
                                    <li><span class="open_2" data-id="major-2">专业二</span></li>
                                    <li><span class="open_2" data-id="major-3">专业三</span></li>
                                </ul>
                            </li>
                            <li><span class="open_1" data-id="school-2">大学二</span></li>
                        </ul>
                    </li>
                </ul>
                </div>
                <div id="select">
                    <p class="add">增加</p>
                    <p class="edit">编辑</p>
                    <p class="del">删除</p>
                    <p class="close1">取消</p>
                </div>




				
		</div>
<script type="text/javascript">
$(document).ready(function(){
		$('input[name=date-range-picker]').daterangepicker().prev().on(ace.click_event, function(){
			$(this).next().focus();
		});

});

$(function(){
    $('body').click(function(){
        $('#select').hide()
    });
    var add = $('.add');
    $('#tree').on('mousedown','.parent_1 li span',function(event){
        event.preventDefault();
        if(event.button == 2){
            var tar = this;
            tar.oncontextmenu=function(){
                $('#select').show().css({top:event.pageY,left:event.pageX});
                // 最后一级不显示增加
                if($(tar).parent().parent().hasClass('parent_5')){
                    $('.add').hide();
                }else{
                    $('.add').show();
                }
                // 第一级不显示编辑
                if($(tar).hasClass('open_0')){
                    $('.edit').hide();
                }else{
                    $('.edit').show();
                }


                $('.add').bind("click",function(){

                    var strName = str_name();

                    $.post('Application/Home/View/School/remove1.php',{'act':'add','id':$(tar).attr('data-id')},function(data){
                        console.log(data)
                        if($(tar).parent().children('ul').length == '0' && $(tar).parent().parent().hasClass('parent_4')){

                            $(tar).addClass('act_jian').parent().append('<ul class="parent_5"><li><span >'+strName+'</span></li></ul>');

                        }else if($(tar).parent().children('ul').length == '0' && $(tar).parent().parent().hasClass('parent_3')){
                            console.log($(tar))
                            $(tar).addClass('act_jian').parent().append('<ul class="parent_4"><li><span class="open_3">'+strName+'</span></li></ul>');

                        }else if($(tar).parent().children('ul').length == '0' && $(tar).parent().parent().hasClass('parent_2')){

                            $(tar).addClass('act_jian').parent().append('<ul class="parent_3"><li><span class="open_2">'+strName+'</span></li></ul>');

                        }else if($(tar).parent().children('ul').length == '0' && $(tar).parent().parent().hasClass('parent_1')){

                            $(tar).addClass('act_jian').parent().append('<ul class="parent_2"><li><span class="open_1">'+strName+'</span></li></ul>');

                        }
                        /*没有下级元素end*/
                        else if($(tar).parent().parent().hasClass('parent_3')){

                            $(tar).parent().children('ul').append('<li><span class="open_3">'+strName+'</span></li>');

                        }else if($(tar).parent().parent().hasClass('parent_2')){

                            $(tar).parent().children('ul').append('<li><span class="open_2">'+strName+'</span></li>');

                        }else if($(tar).parent().parent().hasClass('parent_1')){

                            $(tar).parent().children('ul').append('<li><span class="open_1">'+strName+'</span></li>');

                        }else{

                            $(tar).parent().children('ul').append('<li><span>'+strName+'</span></li>');

                        }
                    })
                    $('#select').hide();
                    $('.add').unbind("click");
                })
                $('.edit').bind("click",function(){

                    var strName = str_name();
                    $.post('Application/Home/View/School/remove1.php',{'act':'setname','id':$(tar).attr('data-id')},function(data){
                        console.log(data)
                        $(tar).text(strName);
                    })
                    $('#select').hide();
                    $('.edit').unbind("click");
                })
                $('.del').bind("click",function(){
                    $.post('Application/Home/View/School/remove1.php',{'act':'remove','id':$(tar).attr('data-id')},function(data){
                        console.log(data);
                        //如果没有子元素连UL都删除
                        if($(tar).parent().parent().children().length == "1"){
                            $(tar).parent().parent().parent().children('span').removeClass('act_jian');
                            $(tar).parent().parent().remove();
                        }else{
                            //正常去掉元素
                            $(tar).parent().remove();
                        }
                    })

                    $('#select').hide();
                    $('.del').unbind("click");
                })
                $('.close1').bind("click",function(){
                    $('#select').hide();
                    $('.close1').unbind("click");
                })                                                
                return false;
            }
        }
        $('.add,.edit,.del,.close1').unbind("click");
    })
    function str_name(){
        var str = prompt('列名字');
        if(str){
            return str;
        }else{
            str = "新增";
            return str;
        }
    }
});

//下滑上滑
    $('#tree').on('dblclick','.open_3',function(){

        if($(this).parent().find('.parent_5').hasClass('open')){
            $(this).removeClass('act_jia').addClass('act_jian');
            $(this).parent().find('.parent_5').stop().removeClass('open').slideDown();
        }else if($(this).parent().find('.parent_5').length == 0){
            return;
        }else{
            $(this).removeClass('act_jian').addClass('act_jia');
            $(this).parent().find('.parent_5').stop().slideUp().addClass('open');
        }
    })
    $('#tree').on('dblclick','.open_2',function(){
        if($(this).parent().find('.parent_4').hasClass('open')){
            $(this).removeClass('act_jia').addClass('act_jian');
            $(this).parent().find('.parent_4').stop().removeClass('open').slideDown();
        }else if($(this).parent().find('.parent_4').length == 0){
            return;
        }else{
            $(this).removeClass('act_jian').addClass('act_jia');
            $(this).parent().find('.parent_4').stop().slideUp().addClass('open');
        }
    })
    $('#tree').on('dblclick','.open_1',function(){
        if($(this).parent().find('.parent_3').hasClass('open')){
            $(this).removeClass('act_jia').addClass('act_jian');
            $(this).parent().find('.parent_3').stop().removeClass('open').slideDown();
        }else if($(this).parent().find('.parent_3').length == 0){
            return;
        }else{
            $(this).removeClass('act_jian').addClass('act_jia');
            $(this).parent().find('.parent_3').stop().slideUp().addClass('open');
        }
    })
    $('#tree').on('dblclick','.open_0',function(){
        if($('.parent_2').hasClass('open')){
            $(this).removeClass('act_jia').addClass('act_jian');
            $('.parent_2').stop().removeClass('open').slideDown();
        }else if($(this).parent().find('.parent_2').length == 0){
            return;
        }else{
            $(this).removeClass('act_jian').addClass('act_jia');
            $('.parent_2').stop().slideUp().addClass('open');
        }
    });

    // 选中样式
    $('#tree').on('click','.parent_1 span',function(){
        $('.parent_1 span').removeClass('act')
        $(this).addClass('act');
    });
</script>
</block>



